# Telegram-Бот для задач и календаря Bitrix24

Этот проект реализует бота в Telegram, который работает с задачами и календарём Bitrix24
согласно ТЗ: авторизация по логину и общему паролю, просмотр и фильтрация задач, создание задач,
просмотр и создание мероприятий календаря.

## Структура проекта

- `main.py` — точка входа бота.
- `config.py` — настройки бота (токен, общий пароль, URL вебхука Bitrix24).
- `auth.py` — логика авторизации (логин + общий пароль, привязка Telegram ↔ Bitrix24).
- `bitrix_api.py` — обёртка над REST API Bitrix24.
- `keyboards.py` — клавиатуры (Reply и Inline).
- `handlers/`
  - `start.py` — обработчик /start и меню.
  - `auth_handler.py` — сценарий авторизации /login и выход /logout.
  - `tasks.py` — логика задач (список, фильтр, создание).
  - `calendar_handler.py` — логика календаря (список, создание).
- `bot_data.sqlite3` — база данных (создаётся автоматически при первом запуске).

## Установка и запуск

1. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

2. В файле `config.py`:
   - Укажите `TELEGRAM_BOT_TOKEN` — токен вашего Telegram-бота.
   - Укажите `BITRIX_WEBHOOK_BASE_URL` — адрес вебхука Bitrix24.
   - Задайте `COMMON_PASSWORD` — общий пароль для всех сотрудников.

3. В файле `auth.py` заполните словарь `LOGIN_MAP`:

   ```python
   LOGIN_MAP = {
       "ivan": {"bitrix_user_id": 1, "name": "Иван Иванов"},
       "petr": {"bitrix_user_id": 2, "name": "Петр Петров"},
   }
   ```

4. Запустите бота:

   ```bash
   python main.py
   ```

5. В Telegram:
   - Откройте вашего бота.
   - Введите `/start`.
   - Введите `/login` для авторизации.
   - После авторизации используйте кнопки «Задачи», «Календарь», «Мой профиль».

## Примечания

- Модуль `bitrix_api.py` содержит примеры вызова методов Bitrix24 и может потребовать адаптации
  под вашу конкретную конфигурацию портала (особенно для календаря).
- Бот использует SQLite для хранения привязок пользователей.
- Даты, которые вводит пользователь, всегда в формате `dd.mm.yyyy`, внутри системы
  они конвертируются в ISO-формат.
